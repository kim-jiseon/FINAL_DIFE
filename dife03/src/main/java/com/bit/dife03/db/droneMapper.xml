<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="drone">
  	<!-- 회원/비회원 꼭 나눠야하는 명령문은?? -->  	
  	
  	<!-- 최초 전체 목록, 검색결과 -->
	<select id="selectAll_dro" resultType="droneVo">
	    select d.dro_no, dro_photo, dro_name, dro_series, pos_price from drone d, possesion p where d.dro_no=p.dro_no order by d.first_time
		<if test="">
		
		</if>
	</select>
	
	<!-- 전체 레코드 수 집계 -->
	<select id="get_droCount" resultType="java.lang.Integer">
		select count(*) from drone 
		<choose>
			<!-- 대여일(반납일 포함)로만 검색 -->
			<when test="calendar != null and series == null and price == null">
				where #{bas_rental} >= #{sysdate} and #{bas_return} > #{bas_rental}
			</when>
			<!-- 시리즈명으로만 검색 -->
			<when test="series != null and calendar == null and price == null">
				where dro_series=#{series} 
				<!-- 서브메뉴도 검색 -->
				<if test="sub_series_01 != null and sub_series_02 != null">
					where dro_name like '%'|| #{sub_series_02} ||'%'
				</if>
			</when>
			<!-- 가격으로만 검색 -->
			<when test="price != null and calendar == null and series == null">
				where pos_price and =#{price} 
				<!-- 서브메뉴도 검색 -->
				<if test="">
					where 
				</if>
			</when>
			<!-- 대여일(반납일 포함), 시리즈명으로 검색 -->
			<when test="calendar != null and series != null and price == null">
				where
			</when>
			<!-- 대여일(반납일 포함), 가격으로 검색 -->
			<when test="calendar != null and price != null and series == null">
				where
			</when>
			<!-- 시리즈명, 가격으로 검색 -->
			<when test="series != null and price != null and calendar == null">
				where
			</when>
			<!-- 모든 조건(대여일(반납일 포함),시리즈명,가격)으로 검색 -->
			<otherwise>
				where #{bas_rental} >= #{sysdate} and #{bas_return} > #{bas_rental} 
				and dro_series=#{series} pos_price and =#{price}
			</otherwise>
		</choose>
	</select>
  	
  	<!-- 상세페이지 -->  	
  	<select id="sel_droDetail" resultType="droneVo">
		select d.* from drone d inner join possesion p on d.#{dro_no}=p.#{dro_no} 
		inner join rental r on r.#{ren_no}=p.#{ren_no} 
		inner join basket b on b.#{pos_no}=p.#{pos_no}
	</select>
	
	<!-- 장바구니담기 -->
	<insert id="in_droBasket">
		insert into orders values(#{ord_no},#{mem_no},#{ord_amount},#{ord_price},0,#{ord_fin_price},sysdate,#{ord_pay_state})
	</insert>
  
</mapper>